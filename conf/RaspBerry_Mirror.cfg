#!/usr/bin/python
# -*- coding: utf-8 -*-

import os, sys, logging
import time

# ##############################################################################################
# # Updates
# # --chmod=Dug+rwx : Aggiunto per permettere la creazione delle dir con uno specifico MASK.
# #                   Altrimenti (da windows) lo creava senza attributi. Non so perché.
# ##############################################################################################


# #########################################################################
# # Global Variables
# #########################################################################
loretoHome          = 'loreto@192.168.1.22:22'
loretoHome          = 'loreto@192.168.1.25'
loretoHome          = 'localhost'                    # prevede l'apertura di un tunnel SSH verso il pc di casa
loretoHome          = '192.168.1.21:22'
loretoHome          = 'loreto.homedns.org'
loretoHome          = 'loreto.dyndns.ws'
loretoHome          = '192.168.1.21'
loretoHome          = 'esil610'
loretoHomeViaItaca  = 'MyLoopback'              # Non funziona con ul nome
loretoHomeViaItaca  = '192.168.0.22'
loretoHomeViaItaca  = '192.168.58.1'

# #########################################################################
# # getTime()
# #########################################################################
def getTime():
    Tuple   = time.localtime()
    string  = time.strftime("%Y-%m-%d_%H-%M-%S", Tuple)
    string  = time.strftime("%Y-%m-%d", Tuple)
    return string

# #########################################################################
# # getcurrPath()
# #########################################################################
def getcurrPath():
    scriptDir   = os.path.split(os.path.abspath(sys.argv[0]))
    return scriptDir

backupSUFFIX = getTime()

MyKey = '"/cygdrive/c/Documents and Settings/f602250/.ssh/id_rsa"'
MyKey = '"/cygdrive/c/Users/f602250/.ssh/id_rsa"'
Main = {
    'LOG_CONSOLE'           : logging.INFO,
    'LOG_FILE'              : logging.DEBUG,
    'Type of Command'       : 'TRAPPED',
    'Type of Command'       : 'SYSTEM',

    'grep options'          : ' | grep -iv "total size is" | grep -iv "bytes/sec" | grep -iv " file list" | grep -iv " to consider" | grep -iv "(xfer#"',

        # -----------------------------------------------------------------------------------
        # - Vale per tutti i progetti del file
        # - Quelli all'interno del progetto si aggiungono o rimpiazzano a questi valori
        # -----------------------------------------------------------------------------------
    'rSync BASE Options'        : '--human-readable --progress --update --archive --links --delete-after --numeric-ids --verbose --compress',
    'rSync EXCLUDED PATTERN'    : '--exclude *.log.* --exclude /Thumbs.db',
    'rSync OTHER Options'       : "--chmod=Dug+rx,Du+w,Fugo+r,Fu+w",
    'rSync LOG FILE'            : 'RsyncEXE.LOG',
}



##########################################################################################
# # Portit_DiscoD()
##########################################################################################
def Portit_DiscoD():

    machineName         = loretoHomeViaItaca
    UserID              = 'pi'
    login               = '%s@%s'       % (UserID, machineName)


    MainData = {
        'rSync OTHER Options'     : "+ -e ssh --rsync-path='sudo_rsync' -ax -i %s" % (MyKey),
        'rSync EXCLUDED PATTERN'  : '+ --delete-excluded --exclude /Default/Cache/ --exclude z_Film/ --exclude z_Film_divx/',

        'Flusso_MyData' : {

            'Source System'       : 'LOCAL:/cygdrive/d/MyData'  ,
            'Target System'       : '%s:/media/WD640GB/LoretoBK/MyData'    % (login),

            'PATHS' : [
               # [Source subDir                ,Dest include, BACKUP,   BackupSUFFUX],
                ['/Ln-eBooks/'                   ,'=',  [],     False,    backupSUFFIX,    ],
                ['/MP3/'                         ,'=',  [],     False,    backupSUFFIX,    ],
                ['/MP4/'                         ,'=',  [],     False,    backupSUFFIX,    ],
                ['/My Lockbox/'                  ,'=',  [],     False,    backupSUFFIX,    ],
                ['/OS-Drivers/'                  ,'=',  [],     False,    backupSUFFIX,    ],
                ['/Photos/'                      ,'=',  [],     False,    backupSUFFIX,    ],
                ['/PhotosDVD/'                   ,'=',  [],     False,    backupSUFFIX,    ],
                ['/Videos/'                      ,'=',  [],     False,    backupSUFFIX,    ],
            ],
        },

        'Flusso_Progetti' : {
            'rSync OTHER Options'     : "+ -e ssh --rsync-path='sudo rsync' -ax -i %s" % (MyKey),

            'Source System'       : 'LOCAL:/cygdrive/d/Dati'  ,
            'Target System'       : '%s:/media/WD640GB/LoretoBK/Banca_Italia'    % (login),

            'PATHS' : [
              # [Source subDir                ,Dest include, BACKUP,   BackupSUFFUX],
                ['/Progetti/'                  ,'=',  [],     False,    backupSUFFIX,    ],
            ],
        },

    }
    return MainData
